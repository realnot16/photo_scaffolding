Photo Scaffolding
=================

This project provides a complete pipeline to extract, verify, deduplicate, 
and organize large photo and video archives.  
It is designed for cases where media files are scattered across multiple 
drives or cloud storages, and the goal is to build a single clean archive.

General Workflow
----------------

1. **Extract original files**  
   ``extract_media.py`` scans the main source directory and copies all photos 
   and videos into two separate output folders (``output/foto`` and 
   ``output/video``).  
   At this stage, only collection is performed, no classification.

2. **Build the cache**  
   ``cache_builder.py`` computes SHA-256 hashes and metadata for every file.  
   The results are saved as ``cache.json`` files inside the ``cache/`` folder, 
   enabling fast duplicate detection, consistency checks, and missing file 
   discovery.

3. **Find missing files**  
   ``find_missing.py`` compares the extracted output with the secondary sources 
   defined in ``config.json``.  
   If photos or videos are missing, it generates two lists 
   (``missing/missing_foto.txt`` and ``missing/missing_video.txt``) containing 
   filenames, sizes, and expected paths.

4. **Copy missing files**  
   ``copy_missing.py`` attempts to copy files listed as missing from secondary 
   sources into the output.  
   If a file already exists, the script avoids overwriting it and creates a 
   version with a numeric suffix.

5. **Update cache**  
   After copying missing files, run ``cache_builder.py`` again to refresh the 
   cache and ensure consistency.

6. **Remove duplicates**  
   ``remove_duplicates.py`` uses cached hashes to identify duplicates.  
   It keeps only one copy per hash and removes the others.  
   A detailed report is written to ``logs/duplicati_rimossi.txt``.

7. **Organize content**  
   ``organise.py`` uses neural networks (CLIP and face_recognition) to classify 
   photos.  
   Images are automatically moved into three categories:

   - ``Persone`` (people detected by face recognition)  
   - ``Panorami_Animali`` (landscapes and animals)  
   - ``Varie`` (screenshots, memes, uncategorized content)

**verification along the process**  
   ``test.py`` checks whether cached data matches the actual state of the 
   output folder.  
   Useful for quickly validating changes or manual edits.

Project Structure
-----------------

- ``utils/config_loader.py`` → Utility for loading ``config.json`` (not used by the main scripts).  
- ``scripts/`` → Main scripts.  
- ``config.json`` → Configuration of sources, outputs, and supported extensions.  
- ``output/`` → Collected and processed photos/videos.  
- ``cache/`` → File hash cache used for duplicates and missing detection.  
- ``missing/`` → Lists of missing files.  
- ``logs/`` → Execution logs.

``` 
photo_scaffolding/
│
│
├── scripts/
│   ├── extract_media.py
│   ├── cache_builder.py
│   ├── find_missing.py
│   ├── copy_missing.py
│   ├── remove_duplicates.py
│   ├── organise.py
│   └── test.py
│
├── config.json
├── hash_index_output.json   # esempio cache/output
├── README.md
│
├── output/
|   ├── organizzate/
│   ├── foto/
│   └── video/
│
├── cache/
│   ├── foto/
│   └── video/
│
├── missing/
│   ├── missing_foto.txt
│   └── missing_video.txt
│
└── logs/
```

Step-by-step usage
------------------

 1.  python scripts/extract_media.py
 2.  python scripts/cache_builder.py
 3.  python scripts/find_missing.py
 4.  python scripts/copy_missing.py
 5.  python scripts/cache_builder.py
 6.  python scripts/remove_duplicates.py
 7.  python scripts/organise.py

python scripts/test.py

Requirements
------------

- Python 3.9 or higher  
- Libraries: ``tqdm``, ``Pillow``, ``torch``, ``clip``, ``face_recognition``  

Notes
-----

- All logs are written to ``logs/``.  
- Caches are stored in ``cache/`` for reuse and performance.  
- ``hash_index_output.json`` is an example output file generated by ``cache_builder.py``.  


